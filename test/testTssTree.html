<!DOCTYPE html>
<HTML XMLNS:Tree>
<head>
	<meta charset="UTF-8"/>
	<title>Tree test</title>

	<link href="../css/tss.css" rel="stylesheet">
	<link href="../css/JMenu.css" rel="stylesheet">
	<link href="../css/tssTree.css" rel="stylesheet">

	<script src="../tssJS.js"></script>
	<script src="../tssAjax.js"></script>
	<script src="../ui/JMenu.js"></script>
	<script src="../ui/tssTree.js"></script>

<style type="text/css">
 
  #t1 {
    border:1px solid #98989C;
    margin-left: auto;
    margin-right: auto;
    height: 450px;   
  }

</style>

<SCRIPT LANGUAGE="JavaScript">
<!--

URL_SOURCE_TREE = "data/tree.xml?";
URL_SORT_NODE   = "data/_success.xml?";
URL_NODE_DELETE = "data/_success.xml?";

function init() {
 
	$.ajax({
		url: URL_SOURCE_TREE,
		onresult: function() {
			var treeData = this.getNodeValue("ParamTree");
			var tree1 = $.T("tree", treeData);	
			var tree2 = $.T("tree2", treeData);	

			tree1.setActiveTreeNode(3);
			tree2.setCheckValues("2,4,6, 7,8,10", true);

			// 测试树控件事件
			tree1.onTreeNodeActived = function(event) {
				console.log(event.node.id);
			}
			tree1.onTreeNodeDoubleClick = function(event) {
				alert("编辑树节点：" + event.node.name);
			}
			tree1.onTreeNodeMoved = function(event) {
				// sortTreeNode(URL_SORT_NODE, eventObj);
			}
			tree1.onTreeNodeRightClick = function(event) {
				// 显示右键菜单
				var menu = tree1.el.contextmenu;
				if(menu == null) {
					return;
				}

				menu.show(event.clientX, event.clientY);
			}
		},

		onexception: function() {
			alert("ajax has exception");
		}
	});
 

	initMenus();
}

function initMenus() {
    var item1 = {
        label:"编辑",
        callback:function() {
            alert("编辑树节点：" + $.T("tree").getActiveTreeNodeAttr("name"));
            // modifyTreeNode(6, 'name', '天地玄黄', true);
        }
    }
    var item2 = {
        label:"删除",
        callback:function() {
            $.T("tree").removeTreeNode($.T("tree").getActiveTreeNode());
        }
    }
    var item3 = {
        label:"新建",
        callback:function() {
           var xmlNode = $.XML.toNode('<treeNode id="3" icon="param.gif" disabled="0" name="新增节点' + $.getUniqueID() + '" />');
           $.T("tree").addTreeNode(xmlNode);
        }
    }

    var menu1 = new $.Menu();
    menu1.addItem(item3);
    menu1.addItem(item2);
	menu1.addItem(item1);

    $1("tree").contextmenu = menu1;
}

function moveTreeNode(fromID, toID) {
	var from = $.T("tree").getTreeNodeById(fromID);
	var to = $.T("tree").getTreeNodeById(toID);
	$.T("tree").moveTreeNode(from, to);
}

window.onload = init;
   
//-->
</SCRIPT>
</head>

<body>

	<table id="t1" border="1">
	 	<tr>
			<td width="400"> - 普通树</td>
			<td width="400"> - 多选树</td>
		</tr>
		<tr height="350">
			<td>
				<Tree:Box id="tree" treeType="single"></Tree:Box>
			</td>
			<td>
				<Tree:Box id="tree2" treeType="multi" selectSelf="false"></Tree:Box>
			</td>
		</tr>
		<tr>
			<td>-
				<input type="button" value="getActiveNode" onclick="alert($.T('tree').getActiveTreeNode().id);"/>
				<input type="button" value="移动节点" onclick="moveTreeNode(9, -2);"/>
				<br/>-
				<input type="button" value="搜索" onclick="$.T('tree').searchNode('子组');"/>
			</td>
			<td>-
				<input type="button" value="获取选中节点" onclick="alert($.T('tree2').getCheckedIds(false));"/>
			</td>
		</tr>
	</table>

</body>
</html>