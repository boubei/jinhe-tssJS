<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>
            图片墙
        </title>
        <style type="text/css">
 
            html {
                height: 100%;
            }
            body{
                background: url("img/bg2.jpg") no-repeat;
                overflow: hidden;
                height: 100%;
            }
            .polaroid{
                padding: 10px;
                background: #FFF;
                text-align: center;
                width: auto;
                position: absolute;
            }
            .cover{
                position: absolute;
                width: 100%;
                height: 100%;
                z-index: 10;
            }
        </style>

        <script src='../../../src/tssJS.js'></script>

        <script type="text/javascript">

            var prePhoto;

            function drag(obj) {
                obj.onmousedown = function(ev) {
                    var oev = ev || event;
                    var disX = oev.clientX - obj.offsetLeft;
                    var disY = oev.clientY - obj.offsetTop;
                    document.onmousemove = function(ev) {
                        var oev = ev || event;
                        var left = oev.clientX - disX;
                        var top = oev.clientY - disY;
                        obj.style.left = left + 'px';
                        obj.style.top = top + 'px';
                    }
                    document.onmouseup = function() {
                        document.onmousemove = null;
                        document.onmouseup = null;
                    }
                }
            }

            // 随机图片布局的生成
            function resize() { 
                var winh = $.getInner().height; // 获取窗口大小
                var winw = $.getInner().width; 
 
                $(".cover").each(function(i, coverDiv){
                    var currentPhoto = coverDiv.parentNode;

                    currentPhoto.style.left = Math.random() * (winw - 1.3 * coverDiv.offsetWidth) + 'px'; // 设置随机left
                    currentPhoto.style.top  = Math.random() * (winh - 100 - coverDiv.offsetHeight) + 'px';

                    var deg = Math.random() * 45; // 随机角度
                    if (i % 2 == 0) {
                        deg = -deg; // 图片顺、逆时针旋转交替进行
                    }
                    
                    currentPhoto.style.webkitTransform = 'rotate(' + deg + "deg)"; //设置旋转度数
                    currentPhoto.style.mozTransform = 'rotate(' + deg + "deg)";
                    currentPhoto.style.oTransform = 'rotate(' + deg + "deg)";
                    currentPhoto.style.msTransform = 'rotate(' + deg + "deg)";
                    currentPhoto.style.transform = 'rotate(' + deg + "deg)";

                    coverDiv.onmousedown = function() { // 选中图片
                        if(prePhoto) {
                            prePhoto.style.zIndex = 0; //上一张图片的zIndex变为0
                        }
                        currentPhoto.style.zIndex = 1000; //当前图片调整到最上层

                        drag(currentPhoto);      // 实现当前图片的拖拽
                        prePhoto = currentPhoto; // 更新上一张图片为本次的图片
                    }
                });
            }

            window.onload = function() {
                var loop = 11;
                while(--loop) {
                    var photoDiv = $.createElement("div", "polaroid");
                    var coverDiv = $.createElement("div", "cover");
                    var imgEl = $.createElement("img");
                    imgEl.src = "img/" + loop + ".png";
                    var pEl = $.createElement("p");
                    $(pEl).html("可以使用键盘上的左右箭头进行旋转调整");

                    photoDiv.appendChild(coverDiv);
                    photoDiv.appendChild(imgEl);
                    photoDiv.appendChild(pEl);
                    document.body.appendChild(photoDiv);
                }
 
                resize();  // 页面加载完成之后的随机参数生成
                window.onresize = resize; //页面大小调整后重新调整参数
                
                document.onkeydown = function(event) { //键盘按下
                    var deg = $(prePhoto).css('transform').split(",")[1].trim(); //获取图片当前的旋转度数
                    deg = deg / Math.PI * 180;

                    if (event.keyCode == 37) { // 左箭头
                        deg--;
                    } else if (event.keyCode == 39) { // 右箭头
                        deg++;
                    } else {
                        return false;
                    }
                    prePhoto.style.webkitTransform = 'rotate(' + deg + "deg)"; // 重新设置角度
                    prePhoto.style.mozTransform = 'rotate(' + deg + "deg)";
                    prePhoto.style.oTransform = 'rotate(' + deg + "deg)";
                    prePhoto.style.msTransform = 'rotate(' + deg + "deg)";
                    prePhoto.style.transform = 'rotate(' + deg + "deg)";
                }
            }
        </script>
    </head>
    
    <body>
      
    </body>

</html>